<ng-container *ngIf="!roomLink else showGame">
  <div class="form-group">
    <label for="username">Username</label>
    <input id="username" class="form-control"
           [(ngModel)]="userName" autoFocus
           (keyup.enter)="userName && join()" required />
    <small id="usernameHelp" class="form-text text-muted">Enter your username</small>
    <div class="mt-3 d-flex justify-content-center">
      <button class="btn btn-primary" (click)="join()" [disabled]="!userName">Join Room</button>
    </div>
  </div>
</ng-container>

<ng-template #showGame>
  <div class="d-flex">
    <div class="form-group w-100">
      Link to this room:<br/>
      <a href="{{roomLink}}" target="_blank"> {{roomLink}}</a>
      <button class="btn btn-sm btn-outline-secondary" id="roomLink" ngxClipboard [cbContent]="roomLink">Copy</button><br/>
      <a *ngIf="videoLink" href="{{videoLink}}" target="_blank">Join video conference</a>
    </div>
  </div>

  <div class="d-flex">
    <button class="btn btn-sm btn-outline-primary mr-1" *ngIf="!game.gameOn" type="button" (click)="startGame()">Start Game</button>
    <button class="btn btn-sm btn-outline-primary mr-1" *ngIf="game.gameOn" type="button" (click)="next()">Next</button>
    <button class="btn btn-sm btn-outline-secondary" type="button" (click)="clearChat()">Clear chat</button>
  </div>

  <hr>

  <ng-container *ngIf="player">
    <div>
      <div>Welcome, <b>{{player.name}}</b></div>
      <div>This game is <b>{{game.gameOn ? 'On' : 'Over'}}</b></div>
      <div>Your role is <b>{{player.role}}</b></div>
      <div>You are <b>{{player.isAlive ? 'alive' : 'dead'}}</b></div>
    </div>
    <hr>
  </ng-container>

  <ng-container *ngIf="game">
    <div class="">
      <div>It is <b>{{game.gameState == 'Night' ? 'Night' : 'Day'}}</b></div>
      <div>Phase: <b>{{game.gameState}}</b></div>
      <div *ngIf="countdown">Time left: <b>{{countdown}}</b> seconds</div>
    </div>

    <div class="alert alert-info alert-dismissible fade show" role="alert">
      <ng-container>Hint: Talk to other players and try to find mafia and prove your position to other players. Then chose who do you suspect.</ng-container>
      <button type="button" class="close" data-dismiss="alert" aria-label="Close">
        <span aria-hidden="true">&times;</span>
      </button>
    </div>
  </ng-container>

  <ng-container *ngIf="gamePlayers.length">
    <h2>Players in the game: </h2>
    <div class="" *ngFor="let player of gamePlayers"
         [style.textDecorationLine]="player.isAlive ? '' : 'line-through'">
      <b>{{player.number}}: {{player.name}}</b>
      <ng-container *ngIf="player.role"> - <b>{{player.role}}</b></ng-container>

      <button *ngIf="player.isCandidate"
              class="btn btn-sm btn-primary"
              (click)="vote(player.number)"
              [disabled]="hasVoted">Vote</button>
    </div>
  </ng-container>

  <ng-container *ngIf="roomPlayers.length">
    <h2>Players in the room: </h2>
    <div class="" *ngFor="let player of roomPlayers" [ngClass]="{'text-secondary': !player.isOnline}">
      {{player.name}} {{player.isOnline}}
    </div>
  </ng-container>

  <hr>
  <b>Chat</b>
  <div class="input-group">
    <input class="form-control" type="text"
           [(ngModel)]="newMessage" (keyup.enter)="newMessage && sendMessage()" required/>
    <div class="input-group-append">
      <button class="btn btn-sm btn-outline-primary" (click)="sendMessage()" [disabled]="!newMessage">Send</button>
    </div>
  </div>
  <div class="px-2">
    <pre *ngFor="let message of messages">{{message}}</pre>
  </div>
</ng-template>
