<ng-container *ngIf="!roomLink else showGame">
  <login [join]="true"></login>
</ng-container>

<ng-template #showGame>
  <div>
    <div>Link to this room:</div>
    <div>
      <a href="{{roomLink}}" target="_blank"> {{roomLink}}</a>
      <button class="btn btn-sm btn-outline-secondary ml-1 "id="roomLink" ngxClipboard [cbContent]="roomLink">Copy</button>
    </div>
    <div *ngIf="videoLink" ><a href="{{videoLink}}" target="_blank">Join video conference</a></div>
    <div class="form-check pl-1">
      <input class="form-check-inline" id="autoJoin" type="checkbox" [(ngModel)]="autoJoin" (click)="toggleJoinGame()"/>
      <label class="form-check-label" for="autoJoin">Automatically join next game</label>
    </div>
  </div>
  <hr>

  <ng-container *ngIf="player">
    <player-info [endGameMessage]="endGameMessage"
                 [gameOn]="game?.gameOn"
                 [player]="player"
                 [state]="state"
                 [winner]="winner"></player-info>
    <hr>
  </ng-container>

  <ng-container *ngIf="game">
    <app-news [currentDay]="game.dayNumber"
              [news]="game.news"
              [player]="player"
              [civiliansWin]="game.civiliansWin"></app-news>
    <hr>
  </ng-container>

  <ng-container *ngIf="game?.gameOn">
    <game-info [countdown]="countdown"
               [game]="game"
               [player]="player"></game-info>
    <hr>
  </ng-container>

  <ng-container *ngIf="isHost">
    <host-info [game]="game" (gameStarting)="votedFor=$event"></host-info>
    <hr>
  </ng-container>

  <ng-container *ngIf="players.length">
    <ng-container *ngIf="player.isAlive && game.gameState === 'Night' && player.role === 'Civilian'">
      Once you are ready:
      <button class="btn btn-sm btn-primary"
              (click)="vote(0)"
              [disabled]="votedFor !== null || !wakeUpReady">wake up</button>
      <hr>
    </ng-container>

    <ng-container *ngIf="game.gameState === 'Tiebreaker'">
      How do you find <colorize-user-list [players]="candidates()"></colorize-user-list>?<br>
      <button class="btn btn-sm"
              *ngIf="player.isAlive"
              (click)="vote(-1)"
              [ngClass]="voteButtonClass(votedFor === null || votedFor, votedFor !== null && !votedFor)"
              [disabled]="votedFor !== null">guilty</button> &nbsp;
      <span *ngIf="!player.isAlive" class="badge badge-danger"> Guilty </span>
      <ng-container *ngIf="game?.tiebreakerVoted[-1]?.length">
        (<colorize-user-list [players]="game.tiebreakerVoted[-1]"></colorize-user-list>)
      </ng-container>
      <br>

      <span *ngIf="!player.isAlive" class="badge badge-success"> Not guilty </span>
      <button class="btn btn-sm"
              *ngIf="player.isAlive"
              (click)="vote(0)"
              [ngClass]="voteButtonClass(votedFor === null || !votedFor, votedFor !== null && votedFor)"
              [disabled]="votedFor !== null">Not guilty</button>
      <ng-container *ngIf="game?.tiebreakerVoted[0]?.length">
        (<colorize-user-list [players]="game.tiebreakerVoted[0]"></colorize-user-list>)
      </ng-container>


      <hr>
    </ng-container>

    <b>Players: </b>
    <div class="" *ngFor="let gPlayer of players; trackBy: trackByName"
         [ngClass]="{'text-muted': !gPlayer.isOnline}"
         title="{{gPlayer.isOnline?'':'Offline'}}"
         [style.textDecorationLine]="gPlayer.isAlive ? '' : 'line-through'"
    >
      {{gPlayer.number}}: {{gPlayer.name}}

      <ng-container *ngIf="player.name === gPlayer.name">(you)</ng-container>
      <ng-container *ngIf="player.name === game.host">(host)</ng-container>
      <span *ngIf="gPlayer.role" appColorizeUser [player]="gPlayer"> - {{gPlayer.role}}</span>
      <button *ngIf="gPlayer.isCandidate && voteButtonCaption() && gPlayer.name !== player.name"
              class="btn btn-sm ml-1"
              (click)="vote(gPlayer.number)"
              [ngClass]="voteButtonClass(!votedFor || votedFor === gPlayer.number, votedFor && votedFor !== gPlayer.number)"
              [disabled]="voteButtonDisabled(votedFor === gPlayer.number)">{{voteButtonCaption()}}</button>
      <button *ngIf="isHost && player.number !== gPlayer.number && !gPlayer.isOnline && gPlayer.isAlive"
         class="btn btn-sm ml-1 btn-outline-warning" (click)="kick(gPlayer.name)">Kick</button>

      <span *ngIf="gPlayer.isCandidate && (game.gameState === 'Tiebreaker')"
            class="badge badge-pill badge-warning">accused</span>

      <ng-container *ngIf="gPlayer.votedBy && gPlayer.votedBy.length">
        (<colorize-user-list [players]="gPlayer.votedBy"></colorize-user-list>)
      </ng-container>
    </div>
    <hr>
  </ng-container>

  <ng-container *ngIf="guests.length">
    <b>Guests:</b>
    <div class="" *ngFor="let gPlayer of guests trackBy: trackByName"
         [ngClass]="{'text-muted': !gPlayer.isOnline}"
         title="{{gPlayer.isOnline?'':'Offline'}}"
    >
      {{gPlayer.name}}
      <ng-container *ngIf="player.name === gPlayer.name">(you)</ng-container>
      <ng-container *ngIf="player.name === game.host">(host)</ng-container>
    </div>
  </ng-container>

  <ng-container *ngIf="false">
    <messenger></messenger>
  </ng-container>
</ng-template>
