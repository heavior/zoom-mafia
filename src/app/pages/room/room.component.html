<ng-container *ngIf="!roomLink else showGame">
  <div class="form-group">
    <label for="username">Username</label>
    <input id="username" class="form-control"
           [(ngModel)]="userName" autoFocus
           (keyup.enter)="userName && join()" required />
    <small id="usernameHelp" class="form-text text-muted">Enter your username</small>
    <div class="mt-3 d-flex justify-content-center">
      <button class="btn btn-primary" (click)="join()" [disabled]="!userName">Join Room</button>
    </div>
  </div>
</ng-container>

<ng-template #showGame>
  <div class="d-flex">
    <div class="form-group w-100">
      Link to this room:<br/>
      <a href="{{roomLink}}" target="_blank"> {{roomLink}}</a>
      <button class="btn btn-sm btn-outline-secondary" id="roomLink" ngxClipboard [cbContent]="roomLink">Copy</button><br/>
      <a *ngIf="videoLink" href="{{videoLink}}" target="_blank">Join video conference</a>
    </div>
  </div>

  <div class="d-flex">
    <button class="btn btn-sm btn-outline-primary mr-1" *ngIf="!game.gameOn" type="button" (click)="startGame()">Start Game</button>
    <button class="btn btn-sm btn-outline-primary mr-1" *ngIf="game.gameOn" type="button" (click)="next()">Next</button>
    <button class="btn btn-sm btn-outline-secondary" type="button" (click)="clearChat()">Clear chat</button>
  </div>

  <hr>

  <ng-container *ngIf="player">
    <div>
      <div>Welcome, <b>{{player.name}}</b></div>
      <div>This game is <b>{{game.gameOn ? 'On' : 'Over'}}</b></div>
      <div>Your role is <b>{{player.role}}</b></div>
      <div>You are <b>{{player.isAlive ? 'alive' : 'dead'}}</b></div>
    </div>
    <hr>
  </ng-container>

  <ng-container *ngIf="game">
    <div class="">
      <div>It is <b>{{game.gameState === 'Night' ? 'Night' : 'Day'}}</b></div>
      <div>Phase: <b>{{game.gameState}}</b></div>
      <div *ngIf="countdown">Time left: <b>{{countdown}}</b> seconds</div>
    </div>

    <div class="alert alert-info alert-dismissible fade show" role="alert">
      <ng-container>Hint: Talk to other players and try to find mafia and prove your position to other players. Then chose who do you suspect.</ng-container>
      <button type="button" class="close" data-dismiss="alert" aria-label="Close">
        <span aria-hidden="true">&times;</span>
      </button>
    </div>
  </ng-container>

  <ng-container *ngIf="players.length">


    <ng-container *ngIf="game.gameState === 'Night' && player.role === 'Civilian'">
      Once you are ready:
      <button class="btn btn-sm btn-primary"
              (click)="vote(0)"
              [disabled]="votedFor !== null || !wakeUpReady">wake up</button>
      <hr>
    </ng-container>

    <ng-container *ngIf="game.gameState === 'Tiebreaker'">
      How do you find <span
          *ngFor="let vPlayer of candidates(); let isLast=last"
          [ngClass]="{'text-danger':mafiaRole(vPlayer.role), 'text-success': civilianRole(vPlayer.role)}"
          >{{vPlayer.name}}{{isLast ? '' : ', '}}</span>?<br>
      <button class="btn btn-sm"
              (click)="vote(-1)"
              [ngClass]="{'btn-primary':votedFor === null || votedFor, 'btn-secondary': votedFor === 0}"
              [disabled]="votedFor !== null">guilty</button> &nbsp;
      <button class="btn btn-sm"
              (click)="vote(0)"
              [ngClass]="{'btn-primary':!votedFor, 'btn-secondary': votedFor}"
              [disabled]="votedFor !== null">not guilty</button>
      <hr>
    </ng-container>
    <b>Players: </b>
    <div class="" *ngFor="let gPlayer of gamePlayers"
         [ngClass]="{'text-muted': !gPlayer.isOnline}"
         title="{{gPlayer.isOnline?'':'Offline'}}"
         [style.textDecorationLine]="gPlayer.isAlive ? '' : 'line-through'"
    >
      {{gPlayer.number}}: {{gPlayer.name}}
      <ng-container *ngIf="player === gPlayer">(you)</ng-container>
      <span *ngIf="gPlayer.role"
            [ngClass]="{'text-danger':mafiaRole(gPlayer.role), 'text-success': civilianRole(gPlayer.role)}"> - {{gPlayer.role}}</span>
      &nbsp;
      <button *ngIf="gPlayer.isCandidate && voteButtonCaption()"
              class="btn btn-sm"
              (click)="vote(gPlayer.number)"
              [ngClass]="{'btn-primary':!votedFor || votedFor === gPlayer.number, 'btn-secondary': votedFor && votedFor !== gPlayer.number}"
              [disabled]="votedFor">{{voteButtonCaption()}}</button>

      <span *ngIf="gPlayer.isCandidate && (game.gameState === 'Tiebreaker')" class="badge badge-pill badge-warning">accused</span>

      <ng-container *ngIf="gPlayer.votedBy && gPlayer.votedBy.length">
        (<span
          *ngFor="let vPlayer of gPlayer.votedBy; let isLast=last"
          [ngClass]="{'text-danger':mafiaRole(vPlayer.role), 'text-success': civilianRole(vPlayer.role)}"
          >{{vPlayer.name}}{{isLast ? '' : ', '}}</span>)
      </ng-container>
    </div>
  </ng-container>

  <ng-container *ngIf="guests.length">
    <b>Guests:</b>
    <div class="" *ngFor="let player of guests"
         [ngClass]="{'text-muted': !player.isOnline}"
         title="{{player.isOnline?'':'Offline'}}"
    >
      {{player.name}}
    </div>
  </ng-container>

  <hr>
  <b>Chat</b>
  <div class="input-group">
    <input class="form-control" type="text"
           [(ngModel)]="newMessage" (keyup.enter)="newMessage && sendMessage()" required/>
    <div class="input-group-append">
      <button class="btn btn-sm btn-outline-primary" (click)="sendMessage()" [disabled]="!newMessage">Send</button>
    </div>
  </div>
  <div class="px-2">
    <pre *ngFor="let message of messages">{{message}}</pre>
  </div>
</ng-template>
