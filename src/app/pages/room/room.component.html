<ng-container *ngIf="!roomLink else showGame">
<div class="card">
  <div class="card-header">Welcome To Mafia</div>
  <div class="card-body">
    <h5 class="card-title text-center">Join the room to play Mafia</h5>
    <div class="form-group">
      <label for="username">Your name in video conference</label>
      <input id="username" class="form-control"
             [(ngModel)]="userName" autoFocus
             (keyup.enter)="userName && join()" required />
      <small id="usernameHelp" class="form-text text-muted">Name must be unique within the room</small>
      <div class="mt-3 d-flex justify-content-center">
        <button class="btn btn-primary" (click)="join()" [disabled]="!userName">Join Room</button>
      </div>
    </div>
  </div>
</div>
</ng-container>

<ng-template #showGame>
  <div class="d-flex">
    <div class="form-group w-100">
      Link to this room:<br/>
      <a href="{{roomLink}}" target="_blank"> {{roomLink}}</a>
      <button class="btn btn-sm btn-outline-secondary ml-1 " id="roomLink" ngxClipboard [cbContent]="roomLink">Copy</button><br/>
      <a *ngIf="videoLink" href="{{videoLink}}" target="_blank">Join video conference</a>
    </div>
  </div>

  <hr>

  <ng-container *ngIf="player">
    <div>
      <div>Welcome, <b>{{player.name}}</b></div>
      <div>This game is <b>{{state}}</b></div>
      <ng-container *ngIf="player.role === 'Guest'">
        <div>You are a guest</div>
      </ng-container>
      <div class="form-check">
        <input class="form-check-inline" id="autoJoin" type="checkbox" [(ngModel)]="autoJoin" (click)="toggleJoinGame()"/>
        <label class="form-check-label" for="autoJoin">Automatically join next game</label>
      </div>
      <ng-container *ngIf="game.gameOn && player.role !== 'Guest'">
        <div>Your role is <b [class]="{'text-danger': mafiaRole(player.role), 'text-success': civilianRole(player.role)}">{{player.role}}</b></div>
        <div>Your number is <b>{{player.number}}</b></div>
        <div>You are <b>{{player.isAlive ? 'alive' : 'dead'}}</b></div>
      </ng-container>
      <ng-container *ngIf="!game.gameOn && winner">
        <div class="text-danger"><b>{{winner}}</b></div>
        <div *ngIf="endGameMessage">{{endGameMessage}}</div>
      </ng-container>
    </div>
    <hr *ngIf="player.role !== 'Guest'">
  </ng-container>

  <ng-container *ngIf="game.gameOn">
    <div>
      <div>It is <b [class]="dayTime === 'Night' ? 'night' : ''">{{dayTime}} #{{game.dayNumber}} <ng-container *ngIf="dayTime !== 'Night'">({{game.gameState}})</ng-container></b></div>
      <ng-container *ngIf="player.role !== 'Guest'">
        <div><b>{{phaseCaption()}}</b></div>
        <div *ngIf="countdown">Time left: <b>{{countdown}}</b> seconds</div>
      </ng-container>
    </div>
    <br *ngIf="player.role !== 'Guest'">
    <ng-container *ngIf="showHint else hideHint">
      <div>
        <ng-container><i>{{hintCaption()}}</i></ng-container>&nbsp;
        <a (click)="showHint = false;" href>[&times;]</a>
      </div>
    </ng-container>
    <ng-template #hideHint>
      <div><a (click)="showHint = true; false" href>[ show hint >> ]</a></div>
    </ng-template>
    <hr>
  </ng-container>

  <ng-container *ngIf="isHost else notHost">
    <div><b>You are the host!</b></div>
    <ng-container *ngIf="game.gameOn else hostStartGame">
      <ng-container *ngIf="game.gameState === 'Discussion'">
        <div><b>Wait till the players discuss and nominate suspects.</b></div>
        <div><button (click)="next()" class="btn btn-sm btn-outline-primary">Start voting</button></div>
      </ng-container>
    </ng-container>
    <ng-template #hostStartGame>
      <button class="btn btn-sm btn-outline-primary mr-1" *ngIf="!game.gameOn" type="button" (click)="startGame()">Start Game</button>
    </ng-template>
    <hr>
  </ng-container>
  <ng-template #notHost><br></ng-template>

  <ng-container>
    <div>Recent news</div>
    <app-news [currentDay]="game.dayNumber" [news]="game.news" [player]="player"></app-news>
    <hr>
  </ng-container>

  <ng-container *ngIf="players.length">
    <ng-container *ngIf="game.gameState === 'Night' && player.role === 'Civilian'">
      Once you are ready:
      <button class="btn btn-sm btn-primary"
              (click)="vote(0)"
              [disabled]="votedFor !== null || !wakeUpReady">wake up</button>
      <hr>
    </ng-container>

    <ng-container *ngIf="game.gameState === 'Tiebreaker'">
      How do you find <span
          *ngFor="let vPlayer of candidates(); let isLast=last"
          [ngClass]="{'text-danger':mafiaRole(vPlayer.role), 'text-success': civilianRole(vPlayer.role)}"
          >{{vPlayer.number}}: {{vPlayer.name}}{{isLast ? '' : ', '}}</span>?<br>
      <button class="btn btn-sm"
              *ngIf="player.isAlive"
              (click)="vote(-1)"
              [ngClass]="{'btn-primary':votedFor === null || votedFor, 'btn-secondary': votedFor === 0}"
              [disabled]="votedFor !== null">guilty</button> &nbsp;
      <span *ngIf="!player.isAlive" class="badge badge-danger"> Guilty </span>
      <ng-container *ngIf="game.tiebreakerVoted && game.tiebreakerVoted[-1].length">
        (<span
          *ngFor="let vPlayer of game.tiebreakerVoted[-1]; let isLast=last"
          [ngClass]="{'text-danger':mafiaRole(vPlayer.role), 'text-success': civilianRole(vPlayer.role)}"
          >{{vPlayer.number}}: {{vPlayer.name}}{{isLast ? '' : ', '}}</span>)
      </ng-container>
      <br>

      <span *ngIf="!player.isAlive" class="badge badge-success"> Not guilty </span>
      <button class="btn btn-sm"
              *ngIf="player.isAlive"
              (click)="vote(0)"
              [ngClass]="{'btn-primary':!votedFor, 'btn-secondary': votedFor}"
              [disabled]="votedFor !== null">not guilty</button>
      <ng-container *ngIf="game.tiebreakerVoted && game.tiebreakerVoted[0].length">
        (<span
          *ngFor="let vPlayer of game.tiebreakerVoted[0]; let isLast=last"
          [ngClass]="{'text-danger':mafiaRole(vPlayer.role), 'text-success': civilianRole(vPlayer.role)}"
          >{{vPlayer.number}}: {{vPlayer.name}}{{isLast ? '' : ', '}}</span>)
      </ng-container>


      <hr>
    </ng-container>

    <b>Players: </b>
    <div class="" *ngFor="let gPlayer of players"
         [ngClass]="{'text-muted': !gPlayer.isOnline}"
         title="{{gPlayer.isOnline?'':'Offline'}}"
         [style.textDecorationLine]="gPlayer.isAlive ? '' : 'line-through'"
    >
      {{gPlayer.number}}: {{gPlayer.name}}

      <ng-container *ngIf="player.name === gPlayer.name">(you)</ng-container>
      <ng-container *ngIf="player.name === game.host">(host)</ng-container>
      <span *ngIf="gPlayer.role"
            [ngClass]="{'text-danger':mafiaRole(gPlayer.role), 'text-success': civilianRole(gPlayer.role)}"> - {{gPlayer.role}}</span>
      &nbsp;
      <button *ngIf="gPlayer.isCandidate && voteButtonCaption() && gPlayer.name !== player.name"
              class="btn btn-sm"
              (click)="vote(gPlayer.number)"
              [ngClass]="{'btn-primary':!votedFor || votedFor === gPlayer.number, 'btn-secondary': votedFor && votedFor !== gPlayer.number}"
              [disabled]="votedFor">{{voteButtonCaption()}}</button>
      <button *ngIf="isHost && player.number !== gPlayer.number && !gPlayer.isOnline && gPlayer.isAlive"
         class="btn btn-sm btn-outline-warning" (click)="kick(gPlayer.name)">Kick</button>

      <span *ngIf="gPlayer.isCandidate && (game.gameState === 'Tiebreaker')" class="badge badge-pill badge-warning">accused</span>

      <ng-container *ngIf="gPlayer.votedBy && gPlayer.votedBy.length">
        (<span
          *ngFor="let vPlayer of gPlayer.votedBy; let isLast=last"
          [ngClass]="{'text-danger':mafiaRole(vPlayer.role), 'text-success': civilianRole(vPlayer.role)}"
          >{{vPlayer.number}}: {{vPlayer.name}}{{isLast ? '' : ', '}}</span>)
      </ng-container>
    </div>
  </ng-container>

  <ng-container *ngIf="guests.length">
    <b>Guests:</b>
    <div class="" *ngFor="let gPlayer of guests"
         [ngClass]="{'text-muted': !gPlayer.isOnline}"
         title="{{gPlayer.isOnline?'':'Offline'}}"
    >
      {{gPlayer.name}}
      <ng-container *ngIf="player.name === gPlayer.name">(you)</ng-container>
      <ng-container *ngIf="player.name === game.host">(host)</ng-container>
    </div>
  </ng-container>

  <ng-container *ngIf="false">
    <div class="mb-1">
      <b>Chat</b>
      <button class="btn btn-sm btn-outline-secondary ml-1" type="button" (click)="clearChat()">Clear chat</button>
    </div>
    <div class="input-group">
      <input class="form-control" type="text"
             [(ngModel)]="newMessage" (keyup.enter)="newMessage && sendMessage()" required/>
      <div class="input-group-append">
        <button class="btn btn-sm btn-outline-primary" (click)="sendMessage()" [disabled]="!newMessage">Send</button>
      </div>
    </div>
    <div class="px-2">
    <pre *ngFor="let message of messages">{{message}}</pre>
  </div>
  </ng-container>
</ng-template>
