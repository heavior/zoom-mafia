<ng-container *ngIf="!roomLink else showGame">
  <div class="form-group">
    <label for="username">Username</label>
    <input id="username" class="form-control"
           [(ngModel)]="userName" autoFocus
           (keyup.enter)="userName && join()" required />
    <small id="usernameHelp" class="form-text text-muted">Enter your username</small>
    <div class="mt-3 d-flex justify-content-center">
      <button class="btn btn-primary" (click)="join()" [disabled]="!userName">Join Room</button>
    </div>
  </div>
</ng-container>

<ng-template #showGame>
  <div class="d-flex">
    <div class="form-group w-100">
      Link to this room:<br/>
      <a href="{{roomLink}}" target="_blank"> {{roomLink}}</a>
      <button class="btn btn-sm btn-outline-secondary ml-1 " id="roomLink" ngxClipboard [cbContent]="roomLink">Copy</button><br/>
      <a *ngIf="videoLink" href="{{videoLink}}" target="_blank">Join video conference</a>
    </div>
  </div>

  <div class="d-flex">
    <button class="btn btn-sm btn-outline-primary mr-1" *ngIf="!game.gameOn" type="button" (click)="startGame()">Start Game</button>
    <button class="btn btn-sm btn-outline-primary mr-1" *ngIf="game.gameOn" type="button" (click)="next()">Next</button>
  </div>

  <hr>

  <ng-container *ngIf="player">
    <div>
      <div>Welcome, <b>{{player.name}}</b></div>
      <div>This game is <b>{{state}}</b></div>
      <ng-container *ngIf="game.gameOn">
        <div>Your role is <b [class]="isMafia ? 'text-danger' : 'text-success'">{{player.role}}</b></div>
        <div>Your number is <b>{{player.number}}</b></div>
        <div>You are <b>{{player.isAlive ? 'alive' : 'dead'}}</b></div>
      </ng-container>
      <ng-container *ngIf="!game.gameOn && winner">
        <div class="text-danger"><b>{{winner}}</b></div>
        <div *ngIf="endGameMessage">{{endGameMessage}}</div>
      </ng-container>
    </div>
    <hr>
  </ng-container>

  <ng-container *ngIf="game">
    <div class="">
      <div>It is <b [class]="dayTime === 'Night' ? 'night' : ''">{{dayTime}} #{{game.dayNumber}} <ng-container *ngIf="dayTime !== 'Night'">({{game.gameState}})</ng-container></b></div>
      <div><b>{{phaseCaption()}}</b></div>
      <div *ngIf="countdown">Time left: <b>{{countdown}}</b> seconds</div>
    </div>
    <br>
    <ng-container *ngIf="showHint else hideHint">
      <div>
        <ng-container><i>{{hintCaption()}}</i></ng-container>&nbsp;
        <a (click)="showHint = false;" href>[&times;]</a>
      </div>
    </ng-container>
    <ng-template #hideHint>
      <div><a (click)="showHint = true; false" href>[ show hint >> ]</a></div>
    </ng-template>
    <br>
  </ng-container>

  <ng-container *ngIf="players.length">
    <ng-container *ngIf="game.gameState === 'Night' && isMafia">
      Once you are ready:
      <button class="btn btn-sm btn-primary"
              (click)="vote(0)"
              [disabled]="votedFor !== null || !wakeUpReady">wake up</button>
      <hr>
    </ng-container>

    <ng-container *ngIf="game.gameState === 'Tiebreaker'">
      How do you find <span
          *ngFor="let vPlayer of candidates(); let isLast=last"
          [ngClass]="{'text-danger':mafiaRole(vPlayer.role), 'text-success': civilianRole(vPlayer.role)}"
          >{{vPlayer.number}}: {{vPlayer.name}}{{isLast ? '' : ', '}}</span>?<br>
      <button class="btn btn-sm"
              *ngIf="player.isAlive"
              (click)="vote(-1)"
              [ngClass]="{'btn-primary':votedFor === null || votedFor, 'btn-secondary': votedFor === 0}"
              [disabled]="votedFor !== null">guilty</button> &nbsp;
      <span *ngIf="!player.isAlive" class="badge badge-danger"> Guilty </span>
      <ng-container *ngIf="game.tiebreakerVoted && game.tiebreakerVoted[-1].length">
        (<span
          *ngFor="let vPlayer of game.tiebreakerVoted[-1]; let isLast=last"
          [ngClass]="{'text-danger':mafiaRole(vPlayer.role), 'text-success': civilianRole(vPlayer.role)}"
          >{{vPlayer.number}}: {{vPlayer.name}}{{isLast ? '' : ', '}}</span>)
      </ng-container>
      <br>

      <span *ngIf="!player.isAlive" class="badge badge-success"> Not guilty </span>
      <button class="btn btn-sm"
              *ngIf="player.isAlive"
              (click)="vote(0)"
              [ngClass]="{'btn-primary':!votedFor, 'btn-secondary': votedFor}"
              [disabled]="votedFor !== null">not guilty</button>
      <ng-container *ngIf="game.tiebreakerVoted && game.tiebreakerVoted[0].length">
        (<span
          *ngFor="let vPlayer of game.tiebreakerVoted[0]; let isLast=last"
          [ngClass]="{'text-danger':mafiaRole(vPlayer.role), 'text-success': civilianRole(vPlayer.role)}"
          >{{vPlayer.number}}: {{vPlayer.name}}{{isLast ? '' : ', '}}</span>)
      </ng-container>


      <hr>
    </ng-container>
    <b>Players: </b>
    <div class="" *ngFor="let gPlayer of players"
         [ngClass]="{'text-muted': !gPlayer.isOnline}"
         title="{{gPlayer.isOnline?'':'Offline'}}"
         [style.textDecorationLine]="gPlayer.isAlive ? '' : 'line-through'"
    >
      {{gPlayer.number}}: {{gPlayer.name}}
      <ng-container *ngIf="player.name === gPlayer.name">(you)</ng-container>
      <span *ngIf="gPlayer.role"
            [ngClass]="{'text-danger':mafiaRole(gPlayer.role), 'text-success': civilianRole(gPlayer.role)}"> - {{gPlayer.role}}</span>
      &nbsp;
      <button *ngIf="gPlayer.isCandidate && voteButtonCaption()"
              class="btn btn-sm"
              (click)="vote(gPlayer.number)"
              [ngClass]="{'btn-primary':!votedFor || votedFor === gPlayer.number, 'btn-secondary': votedFor && votedFor !== gPlayer.number}"
              [disabled]="votedFor">{{voteButtonCaption()}}</button>

      <span *ngIf="gPlayer.isCandidate && (game.gameState === 'Tiebreaker')" class="badge badge-pill badge-warning">accused</span>

      <ng-container *ngIf="gPlayer.votedBy && gPlayer.votedBy.length">
        (<span
          *ngFor="let vPlayer of gPlayer.votedBy; let isLast=last"
          [ngClass]="{'text-danger':mafiaRole(vPlayer.role), 'text-success': civilianRole(vPlayer.role)}"
          >{{vPlayer.number}}: {{vPlayer.name}}{{isLast ? '' : ', '}}</span>)
      </ng-container>
    </div>
  </ng-container>

  <ng-container *ngIf="guests.length">
    <b>Guests:</b>
    <div class="" *ngFor="let gPlayer of guests"
         [ngClass]="{'text-muted': !gPlayer.isOnline}"
         title="{{gPlayer.isOnline?'':'Offline'}}"
    >
      {{gPlayer.name}}
      <ng-container *ngIf="player.name === gPlayer.name">(you)</ng-container>
    </div>
  </ng-container>

  <hr>
  <b>Chat</b>
  <button class="btn btn-sm btn-outline-secondary ml-1" type="button" (click)="clearChat()">Clear chat</button>
  <div class="input-group">
    <input class="form-control" type="text"
           [(ngModel)]="newMessage" (keyup.enter)="newMessage && sendMessage()" required/>
    <div class="input-group-append">
      <button class="btn btn-sm btn-outline-primary" (click)="sendMessage()" [disabled]="!newMessage">Send</button>
    </div>
  </div>
  <div class="px-2">
    <pre *ngFor="let message of messages">{{message}}</pre>
  </div>
</ng-template>
